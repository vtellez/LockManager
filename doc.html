---
layout: default
title: Documentation
id: doc
---

<!-- Promo Section -->
<section class="section section-alt section-padded">
        <div class="container-fluid">
          <div class="row-fluid">
            <div class="section-header">
            <h1 class="section-title">              
              Documentation
            </h1>
            </div>
          </div>
          <div class="row-fluid">

            <div class="span12">
 <p class="lead text-center">
  <img src="{{site.url}}images/document.png"/><br/>
      Check the technical documentation for installing and setup {{site.appn}}
    </p>
            </div>
          </div>
        </div>
      </section>

<!-- Latest News -->
<section class="section section-padded">
  <div class="container-fluid">
    <div class="row-fluid">

      <div class="span3">

<div class="accordion" id="accordion2" data-spy="affix" data-offset-top="520" style="min-width:245px;"><br/>
  <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
        Introduction
      </a>
    </div>
    <div id="collapseOne" class="accordion-body collapse in">
      <div class="accordion-inner">
        <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#definition"><i class="icon-chevron-right"></i> Definition</a></li>
          <li><a href="#how"><i class="icon-chevron-right"></i> How it works</a></li>
          <li><a href="#license"><i class="icon-chevron-right"></i> License</a></li>
        </ul>
      </div>
    </div>
  </div>
 <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#install">
        Installation
      </a>
    </div>
    <div id="install" class="accordion-body collapse">
      <div class="accordion-inner">
         <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#prerequisites"><i class="icon-chevron-right"></i> Prerequisites</a></li>
          <li><a href="#download"><i class="icon-chevron-right"></i> Download</a></li>
          <li><a href="#deploy"><i class="icon-chevron-right"></i> Deploy</a></li>
          <li><a href="#create_database"><i class="icon-chevron-right"></i> Create database</a></li>
        </ul>
      </div>
    </div>
  </div>

 <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#config">
        Configuration
      </a>
    </div>
    <div id="config" class="accordion-body collapse">
      <div class="accordion-inner">
         <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#general_config"><i class="icon-chevron-right"></i> General config</a></li>
          <li><a href="#database_config"><i class="icon-chevron-right"></i> Database config</a></li>
          <li><a href="#language_config"><i class="icon-chevron-right"></i> Language config</a></li>
          <li><a href="#scripts_config"><i class="icon-chevron-right"></i> Scripts config</a></li>
          <li><a href="#logs_config"><i class="icon-chevron-right"></i> Logs config</a></li>
          <li><a href="#ssh_config"><i class="icon-chevron-right"></i> SSH config</a></li>
          <li><a href="#crontab_config"><i class="icon-chevron-right"></i> Crontab config</a></li>
        </ul>
      </div>
    </div>
  </div>

 <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#oper">
     Procedures
      </a>
    </div>
    <div id="oper" class="accordion-body collapse">
      <div class="accordion-inner">
         <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#overview"><i class="icon-chevron-right"></i> Manual update (term)</a></li>
          <li><a href="#overview"><i class="icon-chevron-right"></i> Manual update (web)</a></li>
          <li><a href="#overview"><i class="icon-chevron-right"></i> Load custom date</a></li>
        </ul>
      </div>
    </div>
  </div>


 <div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#devel">
        Development
      </a>
    </div>
    <div id="devel" class="accordion-body collapse">
      <div class="accordion-inner">
         <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#overview"><i class="icon-chevron-right"></i> Custom development</a></li>
          <li><a href="#transitions"><i class="icon-chevron-right"></i> API documentation</a></li>
        </ul>
      </div>
    </div>
  </div>

<div class="accordion-group">
    <div class="accordion-heading">
      <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#others">
        Others
      </a>
    </div>
    <div id="others" class="accordion-body collapse">
      <div class="accordion-inner">
         <ul class="nav nav-list bs-docs-sidenav">
          <li><a href="#modals"><i class="icon-chevron-right"></i> User guide</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>


      </div>
 
      <div class="span9">
<br/>
         <h1>Introduction</h1>
                        <section id="definition"><br/>
                        <section id="how"><br/>
                          <p>
                            {{site.appn}} processes remote log files (obtained through web services or via ssh) to analyze them and keep important information in the database server and serve it through an intuitive web interface for users.
                            </p>
                            <br/><img class="img-polaroid" src="{{site.url}}images/assets/func_b.png"/><br/>
                          </p>
                          <pre class="code"><center>This is how {{site.appn}} works</center></pre><br/>

                          <br/><img class="img-polaroid" src="{{site.url}}images/assets/worker_mail.png"/><br/>
                          </p>
                          <pre class="code"><center>This is how {{site.appn}} works</center></pre><br/>

                          <p>
                            {{site.appn}} interpret and crosslink information between logs of different software programs. In addition, you can customize what software we want to analyze, making the application is certainly very flexible and functioanl.
                          </p>

                        <section id="license"><br/>

                        <hr class="invisible" />


                    <h1>Installation </h1>

                        <section id="prerequisites"><br/>
                      <h2>Prerrequisitos</h2>

                <p>{{site.appn}} necesita una máquina con sistema operativo <b>GNU/Linux</b> para funcionar. Las especificaciones ténicas de la máquina (CPU, GB de memoria RAM, GB de disco duro, etc., dependerán del volumen de correo que se registre en la institución/organismo donde se esté instalando la aplicación).</p>

                <p>Software necesario en la máquina (versiones mínimas):</p>
                <pre>
                <ul>
                  <li>PHP v5.1.6</li>
                  <li>MySQL v5.0.77</li>
                  <li>Paquetes necesarios para comunicar PHP con MySQL</li>
                  <li>Servidor web para php (por ejemplo Apache)</li>
                  <li>PERL v5.8.8</li>
                  <li>Módulos de Perl: 
                    <li>- Encode</li>
                    <li>- Time::Local qw(timelocal)</li>
                    <li>- POSIX qw(strftime);</li>
                    <li>- MIME::Words qw(:all)</li>
                    <li>- Time::TAI64 qw/tai2unix/</li>
                    <li>- DBI</li>
                  </li>
                </ul>
                </pre>
                        <section id="license"></br>
                        <section id="download"></br>
                      <h2>Download {{site.appn}}</h2>

                <p>{{site.appn}} puede descargarse de dos formas:</p>
                <br/>
                <p><b>1)</b> Descargando directamente la <b>versión empaquetada en tar.gz</b> de la última release estable:</b></p>
                <pre><i class="icon-download-alt"></i> <a href="http://github.com/vtellez/{{site.appn}}/tarball/master">Descargar tar.gz</a></pre>
                <br/>
                <p><b>2)</b> Utilizando el <b>sistema de versiones (git)</b> del proyecto en github:</b></p>
                <pre>git://github.com/vtellez/{{site.appn}}.git</pre>

                <p>ó</p>

                <pre>https://github.com/vtellez/{{site.appn}}.git</pre>


                        <section id="deploy"><br/>
                      <h2>Variables y nomenclatura</h2>
                    <p>En adelante, usaremos los siguientes términos y variables en esta página de documentación:</p>
                    
                    <pre>
                    <ul>
                    <li><b>$PATH_A_{{site.appn}}</b>: Esta variable hace referencia a la ruta donde se ha desplegado la instalación. <br/>Por ejemplo, la ruta podría ser <code>/var/www/{{site.appn}}</code></li>
                    </ul>
                    </pre>

                        <section id="create_database"><br/>
                      <h2>Creación de la base de datos</h2>
                      
                      <p>Creación del usuario en MySQL para {{site.appn}} de mensajes</p>
                <pre>
                 # mysql -uroot -p<br/>
                 Enter password: (el de root)
                 </pre>
                 <pre>
                 mysql> GRANT ALL PRIVILEGES ON {{site.appn}}.* TO {{site.appn}}@localhost
                        IDENTIFIED BY 'password-de-{{site.appn}}';
                 </pre>
                 <pre>
                 mysql> CREATE DATABASE {{site.appn}};
                 </pre>
                 <pre>
                 mysql> FLUSH PRIVILEGES;
                 </pre>

                <p>Creación de las tablas de {{site.appn}} de mensajes</p>
                <pre>
                 # mysql -u{{site.appn}} -p {{site.appn}} < $PATH_A_{{site.appn}}/mysql-database/schema.sql
                 </pre>
                      


                        <section id="pill-tab3"></br>
                      <h1>Configuration</h1>
                <p>Para la puesta en marcha de aplicación se deberán modificar ciertos ficheros de configuración.</p>
                        <br/> 
                        <section id="general_config"><br/>
                      <h2>Configuración general (config.php)</h2>

                <p>$PATH_A_{{site.appn}}/app/config/config.php.plantilla: Debe eliminarse de la extensión el sufijo ".plantilla". Configurar este fichero para definir la dirección base de la aplicación, la lista de administradores, número de mensajes por página, etc etc. Crear directorio de logs de acuerdo a lo configurado en este fichero.</p>

                        <br/>  
                        <section id="database_config"><br/>
                      <h2>Configuación de la base de datos (database.php)</h2>

                <p>$PATH_A_{{site.appn}}/app/config/database.php.plantilla: Debe eliminarse de la extensión el sufijo ".plantilla". Este fichero incluye la información relativa a la base de datos de la aplicación así como al usuario para ésta, para permitir así la conexión desde php.</p>

                        <br/>  
                        <section id="scripts_config"><br/>
                      <h2>Configuración de logs y scripts (config.pl)</h2>

                <p>$PATH_A_{{site.appn}}/scripts/etc/config.pl.plantilla: Debe eliminarse de la extensión el sufijo ".plantilla". Este fichero incluye información acerca del proceso de parseado de los logs: Definición del dominio principal de la institución, tiempo de vida (en días) de los mensajes en la base de datos, configuración de datos para la conexión con la base de datos desde perl, etc.</p>

                        <section id="logs_config"><br/>
                <p>$PATH_A_{{site.appn}}/scripts/etc/hosts.plantilla: Debe eliminarse de la extensión el sufijo ".plantilla". En este fichero debe incluirse la información de los logs que se quiera procesar. En el propio fichero esta incluido un ejemplo para comprender la sintaxis que se utiliza en el.</p>

                <p>$PATH_A_{{site.appn}}/scripts/bin/actualiza.sh: En este fichero tan solo debe editarse la primera línea no comentada, que hace referencia a la ruta donde se encuentra alojado el directorio "scripts".</p>


                        <section id="ssh_config"><br/>
                      <h2>Configuración sshs</h2>
                <p>{{site.appn}} de mensajes obtiene los logs de las máquinas de forma remota utilizando un protocolo de transmisión de ficheros segura basado en el protocolo ssh (comando scp).</p>

                <p>Es por ello que para que el script principal funcione correctamente, debemos dar permiso a las máquinas remotas para que {{site.appn}} obtenga los logs sin necesidad de establecer un usuario y contraseña. Para ello, se utiliza los certificados de clave pública de la propia máquina.</p>

                <p>Deberemos copiar la clave pública de la máquina que procesará los logs (alojada generalmente en $HOME/.ssh/id_rsa.pub) en la lista de servidores autorizados en las máquinas remotas (definidas normalmente en el archivo $HOME/.ssh/authorized_keys)</p>

                        <section id="crontab_config"><br/>
                      <h2>Configuración crontab</h2>

                <p>{{site.appn}} de mensajes, requiere que se añadan varias entradas en la lista de tareas automáticas del sistema:</p>
                <pre>
                #{{site.appn}}: Ejecución del script que recorre los logs de correo y los guarda en la base de datos<br/>
                */10 0-4,6-23 * * * bash $PATH_A_{{site.appn}}/scripts/bin/actualiza.sh hosts > /tmp/salida<br/>
                <br/>
                #{{site.appn}}: Cada dia borramos los mensajes y accesos más antiguos la base de datos<br/>
                1 5 * * * bash $PATH_A_{{site.appn}}/scripts/bin/borrado_bbdd.sh<br/>
 
               <br/>
                #{{site.appn}}: Calculo de indicadores por horas/días/meses<br/>
                7 0 * * * perl $PATH_A_{{site.appn}}/scripts/bin/indicadores.pl<br/>
                </pre>

                <p>La primera de ellas hace referencia a la frecuencia con la que se quiere que se lean los logs de las distintas máquinas. Dicho de otra forma, con que margen de tiempo con respecto al tiempo real, queremos que se actualicen los datos en la base de datos. En este ejemplo, la frecuencia de parseo sería cada 10 minutos.</p>

                <p>La segunda entrada, debe ejecutarse una vez al día, y será la encargada de eliminar aquellos mensajes con más de X días (configurado en /scripts/etc/config.pl) de antigüedad.</p>

                <p>La última entrada se ejecuta una vez al día y se encarga de calcular los datos necesarios para los indicadores diarios de la aplicación.</p>

      </div>
 </div>
</section>
